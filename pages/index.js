import Head from 'next/head'
import React, { useEffect } from 'react'
import cheerio from 'cheerio';
import fetchdata from 'node-fetch';
import { useContext, } from 'react';
import { useRouter } from 'next/router';
import VideoThumbnail from '../components/VideoThumbnail';


export default function Home({ video_collection }) {

  console.log('====================================');
  console.log(video_collection);
  console.log('====================================');
  return (
    <div >
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="grid grid-cols-1 p-1 sm:pl-4 sm:pr-4 sm:grid-cols-2 gap-x-1  md:grid-cols-3 lg:grid-cols-4 ">
        {
          video_collection.map(video => {
            return (
              <VideoThumbnail details={video} />
            )
          })
        }
      </main>

      <footer >

      </footer>
    </div>
  )
}


export async function getStaticProps() {
  var dataArray = []



  const scrape = async (url) => {

    var TitleArray = []
    var liked = []
    var disliked = []
    var durationArray = []
    var hrefArray = []
    var thumbnail = []


    const response = await fetchdata(url)
    const body = await response.text();
    const $ = cheerio.load(body)



    $('.info a').each((i, el) => {
      const data = $(el).text().trim();
      TitleArray.push(data)


    })
    $('.info a').each((i, el) => {

      const data = $(el).attr('href')
      hrefArray.push(data)

    })


    $('.image a img').each((i, el) => {

      const data = $(el).attr('data-src')
      thumbnail.push(data)


    })

    $('.length').each((i, el) => {

      const data = $(el).text().trim();
      durationArray.push(data)

    })
    $('.likes.good').each((i, el) => {

      const data = $(el).text().trim();
      liked.push(data)

    })
    $('.dislikes.bad').each((i, el) => {

      const data = $(el).text().trim();
      disliked.push(data)

    })




    for (let Page = 0; Page < TitleArray.length; Page++) {
      dataArray.push({
        TitleArray: TitleArray[Page],
        liked: liked[Page],
        disliked: disliked[Page],
        durationArray: durationArray[Page],
        hrefArray: hrefArray[Page],
        thumbnail: thumbnail[Page],
      })
    }

    console.log(TitleArray.length);
    console.log(liked.length);
    console.log(disliked.length);
    console.log(durationArray.length);
    console.log(hrefArray.length);
    console.log(thumbnail.length);
  }
  await scrape(`https://justindianporn.me/`)





  return {
    props: {
      video_collection: dataArray,
    }
  }
}